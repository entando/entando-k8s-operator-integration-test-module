buildPack: entando-maven-lib
buildPackGitURL: https://github.com/entando-k8s/jenkins-x-kubernetes.git
pipelineConfig:
  agent:
    image: docker.io/entando/entando-jx-maven-java11:0.0.39
  env:
    - name: BUILDER_JX_IMAGE
      value: ghcr.io/jenkins-x/builder-jx:2.1.155-778-patch3
    - name: PIPELINE_CODE
      value: cm
    - name: TEST_DEPLOYMENT
      value: "false"
    - name: SKIP_OWASP
      value: "false"
    - name: ENTANDO_DOCKER_IMAGE_INFO_CONFIGMAP
      value: "entando-docker-image-info-v6.3"
    - name: ENTANDO_TEST_REDHAT_REGISTRY_CREDENTIALS
      valueFrom:
        secretKeyRef:
          key: redhat.registry.credentials
          name: entando-jx-common-secret
    - name: EXECUTABLE_TYPE
      valueFrom:
        secretKeyRef:
          name: entando-jx-common-secret
          key: executable.type
  pipelines:
    pullRequest:
      build:
        steps:
          - sh: skaffold-build
            name: container-build
    release:
      build:
        replace: true
        steps:
          - sh: git fetch origin
            name: fetch-history-for-sonar
          - sh: mvn-deploy-release -P${EXECUTABLE_TYPE}
            name: mvn-deploy-release
          - sh: skaffold-build
            name: container-build
